<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å‹•è…³è¸è»Šé€šè·¯å•†åˆä½œå°ˆæ¡ˆé€±å ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #4472C4;
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .editable {
            background-color: transparent;
            border: none;
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            width: 100%;
            padding: 2px;
            outline: none;
        }
        .editable:focus {
            background-color: rgba(255, 255, 255, 0.3);
            border: 1px solid #fff;
        }
        td .editable {
            background-color: transparent;
            color: inherit;
        }
        td .editable:focus {
            background-color: rgba(68, 114, 196, 0.1);
            border: 1px solid #4472C4;
        }
        textarea.editable {
            font-family: inherit;
            font-size: inherit;
            line-height: 1.4;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .section {
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .section-title {
            background-color: #E7F3FF;
            color: #4472C4;
            font-weight: bold;
            padding: 8px;
            margin: -15px -15px 15px -15px;
            border-radius: 5px 5px 0 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .status-green {
            background-color: #92D050;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .status-yellow {
            background-color: #FFC000;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .status-red {
            background-color: #FF0000;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .checkmark {
            color: green;
            font-weight: bold;
        }
        .cross {
            color: red;
            font-weight: bold;
        }
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        .phase {
            text-align: center;
            flex: 1;
        }
        .phase-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .phase-active {
            background-color: #4472C4;
        }
        .phase-completed {
            background-color: #92D050;
        }
        .phase-pending {
            background-color: #B0B0B0;
        }
        .footer {
            background: linear-gradient(90deg, #00CCCC, #0099CC);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            font-style: italic;
            margin-top: 20px;
        }
        .full-width {
            grid-column: 1 / -1;
        }

        /* PDF åˆ—å°æ¨£å¼ */
        @media print {
            body {
                background-color: white !important;
                margin: 0;
                padding: 10px;
                font-size: 12px;
            }
            
            .backup-controls {
                display: none !important;
            }
            
            .header {
                background-color: #4472C4 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .section {
                background-color: white !important;
                border: 1px solid #333 !important;
                page-break-inside: avoid;
                margin-bottom: 15px;
            }
            
            .section-title {
                background-color: #E7F3FF !important;
                color: #4472C4 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .container {
                display: block !important;
            }
            
            .container .section {
                width: 48% !important;
                display: inline-block !important;
                vertical-align: top !important;
                margin-right: 2% !important;
            }
            
            .full-width {
                width: 100% !important;
                display: block !important;
            }
            
            table {
                border-collapse: collapse !important;
                width: 100% !important;
            }
            
            th, td {
                border: 1px solid #333 !important;
                padding: 6px !important;
                font-size: 11px !important;
            }
            
            th {
                background-color: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .status-green, .status-yellow, .status-red {
                border: 1px solid #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .timeline {
                display: flex !important;
                justify-content: space-between !important;
                page-break-inside: avoid;
            }
            
            .phase {
                flex: 1 !important;
                text-align: center !important;
            }
            
            .phase-circle {
                border: 1px solid #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .footer {
                background: linear-gradient(90deg, #00CCCC, #0099CC) !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            input, textarea {
                border: none !important;
                background: transparent !important;
                outline: none !important;
                color: inherit !important;
            }
            
            /* ç¢ºä¿åˆ†é åˆç† */
            .section {
                page-break-inside: avoid;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        ã€å°ˆæ¡ˆé€±å ±ã€‘<input type="text" class="editable" value="AMRå°ˆæ¡ˆé€²åº¦èˆ‡è³‡æºç®¡ç†æ©Ÿåˆ¶å»ºç½®" style="color: white;"> - <input type="text" class="editable" value="å°ˆæ¡ˆç®¡ç†éƒ¨" style="color: white; width: 100px;"> (<input type="text" class="editable" value="w31 2025.07.28-2025.08.01" style="color: white; width: 200px;">)
    </div>

    <div class="backup-controls">
        <button onclick="exportToMarkdown()">ğŸ“ åŒ¯å‡º Markdown</button>
        <button onclick="exportToPDF()">ğŸ“„ åŒ¯å‡º PDF</button>
        <label for="importFile">ğŸ“‚ åŒ¯å…¥ Markdown</label>
        <input type="file" id="importFile" accept=".md,.txt" onchange="importFromMarkdown(event)">
        <span class="backup-status" id="backupStatus">æº–å‚™å°±ç·’</span>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-title">0.å°ˆæ¡ˆæ¦‚æ³</div>
            <table>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">å°ˆæ¡ˆåç¨±</td>
                    <td><input type="text" class="editable" value="AMRå°ˆæ¡ˆé€²åº¦èˆ‡è³‡æºç®¡ç†æ©Ÿåˆ¶å»ºç½®"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">è² è²¬PM</td>
                    <td><input type="text" class="editable" value="å°ˆæ¡ˆç®¡ç†éƒ¨"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">å°ˆæ¡ˆç‹€æ…‹</td>
                    <td><span class="status-yellow"></span> <input type="text" class="editable" value="é€²è¡Œä¸­ (Plan)"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">éœ€æ±‚æè¿°</td>
                    <td><textarea class="editable" style="min-height: 80px; resize: vertical;" placeholder="è«‹æè¿°å°ˆæ¡ˆéœ€æ±‚ã€ç›®æ¨™èˆ‡é æœŸç”¢å‡ºï¼Œä»¥åˆ©åœ˜éšŠå°é½ŠåŸ·è¡Œæ–¹å‘">å»ºç«‹ä¸€å€‹æ©Ÿåˆ¶ä¾†ç®¡ç†AMRæ‰€æœ‰çš„å°ˆæ¡ˆé …ç›®ä¹‹é€²åº¦èˆ‡è³‡æºï¼Œç¢ºä¿å°ˆæ¡ˆå¯ä»¥å¦‚æœŸå¦‚å€¼å®Œæˆã€‚é€éç³»çµ±åŒ–çš„å°ˆæ¡ˆç›¤é»ï¼Œè¿½è¹¤æ¯å€‹å°ˆæ¡ˆçš„åŸ·è¡Œç‹€æ…‹ã€è³‡æºéœ€æ±‚åŠç”¢ç”Ÿæ•ˆç›Šã€‚å»ºç«‹æ¨™æº–åŒ–çš„å°ˆæ¡ˆç®¡ç†æµç¨‹ï¼Œæå‡æ•´é«”å°ˆæ¡ˆæˆåŠŸç‡èˆ‡è³‡æºä½¿ç”¨æ•ˆç‡ï¼Œä¸¦å»ºç«‹å¯è¦–åŒ–çš„å°ˆæ¡ˆå„€è¡¨æ¿ä¾›ç®¡ç†å±¤æ±ºç­–åƒè€ƒã€‚</textarea></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">ç›¸é—œè³‡æ–™</td>
                    <td><input type="text" class="editable" value="å°ˆæ¡ˆç®¡ç†æ¨™æº–ä½œæ¥­ç¨‹åºã€è³‡æºåˆ†é…çŸ©é™£ã€æ•ˆç›Šè©•ä¼°è¡¨"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <div class="section-title">3.é¢¨éšªç®¡ç†</div>
            <table id="riskTable">
                <tr>
                    <th>é¢¨éšªè­˜é¡Œ</th>
                    <th>å½±éŸ¿ç¨‹åº¦</th>
                    <th>æè§£æªæ–½</th>
                    <th>è² è²¬äºº</th>
                    <th>ç›®æ¨™å®Œæˆæ™‚é–“</th>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="å„éƒ¨é–€é…åˆåº¦ä¸è¶³"></td>
                    <td><span class="status-red"></span></td>
                    <td><input type="text" class="editable" value="å»ºç«‹é«˜å±¤æ”¯æŒèˆ‡æ¿€å‹µæ©Ÿåˆ¶"></td>
                    <td><input type="text" class="editable" value="å°ˆæ¡ˆç®¡ç†éƒ¨"></td>
                    <td><input type="text" class="editable" value="8æœˆä¸­æ—¬å®Œæˆ"></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="ç³»çµ±æ•´åˆè¤‡é›œåº¦é«˜"></td>
                    <td><span class="status-yellow"></span></td>
                    <td><input type="text" class="editable" value="åˆ†éšæ®µå°å…¥èˆ‡æ¸¬è©¦é©—è­‰"></td>
                    <td><input type="text" class="editable" value="ITéƒ¨é–€"></td>
                    <td><input type="text" class="editable" value="9æœˆåº•å‰é©—è­‰"></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="è³‡æ–™å“è³ªèˆ‡ä¸€è‡´æ€§"></td>
                    <td><span class="status-yellow"></span></td>
                    <td><input type="text" class="editable" value="å»ºç«‹è³‡æ–™æ¨™æº–åŒ–æµç¨‹"></td>
                    <td><input type="text" class="editable" value="å„å°ˆæ¡ˆè² è²¬äºº"></td>
                    <td><input type="text" class="editable" value="æŒçºŒé€²è¡Œ"></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-title">1.é‡è¦é€²åº¦ / é€²åº¦æ›´æ–°</div>
            <div style="margin-top: 15px;">
                <div><span class="checkmark">âœ“</span> æœ¬é€±å®Œæˆäº‹é …</div>
                <div style="margin-left: 20px; margin-top: 5px;">
                    <span class="checkmark">âœ“</span> <input type="text" class="editable" value="å®Œæˆç¾æœ‰å°ˆæ¡ˆæ¸…å–®ç›¤é»"><br>
                    <span class="checkmark">âœ“</span> <input type="text" class="editable" value="å»ºç«‹å°ˆæ¡ˆåˆ†é¡èˆ‡å„ªå…ˆç´šå®šç¾©"><br>
                    <span class="checkmark">âœ“</span> <input type="text" class="editable" value="åˆ¶å®šå°ˆæ¡ˆç®¡ç†æ¨™æº–ä½œæ¥­ç¨‹åºåˆç¨¿">
                </div>
                
                <div style="margin-top: 15px;"><span class="cross">âœ—</span> ä¸‹é€±é‡é»äº‹é …</div>
                <div style="margin-left: 20px; margin-top: 5px;">
                    <span class="cross">âœ—</span> <input type="text" class="editable" value="è¨­è¨ˆå°ˆæ¡ˆç®¡ç†å„€è¡¨æ¿æ¶æ§‹"><br>
                    <span class="cross">âœ—</span> <input type="text" class="editable" value="å»ºç«‹è³‡æºéœ€æ±‚è©•ä¼°æ¨¡å‹"><br>
                    <span class="cross">âœ—</span> <input type="text" class="editable" value="è¦åŠƒæ•ˆç›Šè¡¡é‡æŒ‡æ¨™èˆ‡KPI"><br>
                    <span class="cross">âœ—</span> <input type="text" class="editable" value="å•Ÿå‹•è·¨éƒ¨é–€å”ä½œæ©Ÿåˆ¶å»ºç«‹">
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">2.é—œéµ NPI</div>
            <table id="npiTable">
                <tr>
                    <th>NPIéšæ®µ</th>
                    <th>Milestone</th>
                    <th>Owner</th>
                    <th>SPI</th>
                    <th>ç‹€æ…‹</th>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C0"></td>
                    <td><input type="text" class="editable" value="å°ˆæ¡ˆç›¤é»èˆ‡éœ€æ±‚ç¢ºèª"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0.9"></td>
                    <td><span class="status-green"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C1"></td>
                    <td><input type="text" class="editable" value="ç®¡ç†æ©Ÿåˆ¶è¨­è¨ˆèˆ‡é©—è­‰"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0.3"></td>
                    <td><span class="status-yellow"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C2"></td>
                    <td><input type="text" class="editable" value="ç³»çµ±å¹³å°å»ºç½®èˆ‡æ¸¬è©¦"></td>
                    <td><input type="text" class="editable" value="ITéƒ¨é–€"></td>
                    <td><input type="text" class="editable" value="0.1"></td>
                    <td><span class="status-red"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C3"></td>
                    <td><input type="text" class="editable" value="è©¦ç‡Ÿé‹èˆ‡æˆæ•ˆé©—è­‰"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0"></td>
                    <td><span class="status-red"></span></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="section full-width">
        <div class="section-title">4.é–‹ç™¼éšæ®µç‹€æ…‹</div>
        <div class="timeline">
            <div class="phase">
                <div class="phase-circle phase-completed"><input type="text" class="editable" value="C0" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="Idea" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="8/5" style="font-size:12px;"><br><input type="text" class="editable" value="å°ˆæ¡ˆç›¤é»å®Œæˆ" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-active"><input type="text" class="editable" value="C1" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="Plan" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="8/20" style="font-size:12px;"><br><input type="text" class="editable" value="ç®¡ç†æ©Ÿåˆ¶è¨­è¨ˆ" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C2" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="EVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="9/15" style="font-size:12px;"><br><input type="text" class="editable" value="ç³»çµ±å¹³å°å»ºç½®" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C3" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="DVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="10/1" style="font-size:12px;"><br><input type="text" class="editable" value="è©¦ç‡Ÿé‹é©—è­‰" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C4" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="PVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="10/15" style="font-size:12px;"><br><input type="text" class="editable" value="æ•ˆæœè©•ä¼°å„ªåŒ–" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C5" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="MP" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="11/1" style="font-size:12px;"><br><input type="text" class="editable" value="æ­£å¼ä¸Šç·šæ¨å»£" style="font-size:12px;"></div>
            </div>
        </div>
    </div>

    <div class="section full-width">
        <div class="section-title">5.ç®¡ç†å±¤æ±ºç­–éœ€æ±‚</div>
        <table id="decisionTable">
            <tr>
                <th style="width: 30%;">æ±ºç­–é …ç›®</th>
                <th style="width: 15%;">ç·Šæ€¥ç¨‹åº¦</th>
                <th style="width: 20%;">é æœŸæ±ºç­–æ™‚é–“</th>
                <th style="width: 35%;">ç›¸é—œå½±éŸ¿</th>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="å°ˆæ¡ˆç®¡ç†ç³»çµ±å¹³å°é¸å‹"></td>
                <td><span class="status-red"></span> <input type="text" class="editable" value="ç·Šæ€¥"></td>
                <td><input type="text" class="editable" value="8æœˆ15æ—¥å‰"></td>
                <td><input type="text" class="editable" value="å½±éŸ¿å¾ŒçºŒç³»çµ±å»ºç½®æ™‚ç¨‹èˆ‡é ç®—"></td>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="è·¨éƒ¨é–€å”ä½œçå‹µæ©Ÿåˆ¶"></td>
                <td><span class="status-yellow"></span> <input type="text" class="editable" value="é‡è¦"></td>
                <td><input type="text" class="editable" value="9æœˆ1æ—¥å‰"></td>
                <td><input type="text" class="editable" value="æ±ºå®šå„éƒ¨é–€åƒèˆ‡ç©æ¥µåº¦èˆ‡é…åˆåº¦"></td>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="å°ˆæ¡ˆåˆ†ç´šèˆ‡è³‡æºé…ç½®æ¨™æº–"></td>
                <td><span class="status-green"></span> <input type="text" class="editable" value="ä¸€èˆ¬"></td>
                <td><input type="text" class="editable" value="9æœˆ20æ—¥å‰"></td>
                <td><input type="text" class="editable" value="å½±éŸ¿è³‡æºåˆ†é…æ•ˆç‡èˆ‡å°ˆæ¡ˆå„ªå…ˆç´š"></td>
            </tr>
        </table>
    </div>

    <div class="footer">
        Innovate Today, Embrace Tomorrow
    </div>

    <script>
        // åŒ¯å‡ºç‚º PDF æ ¼å¼
        function exportToPDF() {
            updateStatus('ğŸ“„ æº–å‚™ç”Ÿæˆ PDF...');
            
            // ç­‰å¾…ä¸€å°æ®µæ™‚é–“è®“ç‹€æ…‹æ›´æ–°é¡¯ç¤º
            setTimeout(() => {
                // è§¸ç™¼ç€è¦½å™¨çš„åˆ—å°å°è©±æ¡†
                window.print();
                updateStatus('âœ… PDF åˆ—å°å°è©±æ¡†å·²é–‹å•Ÿ');
            }, 200);
        }

        // åŒ¯å‡ºç‚º Markdown æ ¼å¼
        function exportToMarkdown() {
            const data = collectFormData();
            const markdown = generateMarkdown(data);
            downloadMarkdown(markdown, `å°ˆæ¡ˆé€±å ±_${data.projectName}_${new Date().toISOString().slice(0, 10)}.md`);
            updateStatus('âœ… Markdown æª”æ¡ˆå·²åŒ¯å‡º');
        }

        // æ”¶é›†è¡¨å–®è³‡æ–™
        function collectFormData() {
            // å®‰å…¨å–å¾—å…ƒç´ å€¼çš„è¼”åŠ©å‡½æ•¸
            function safeGetValue(selector, defaultValue = '') {
                const element = document.querySelector(selector);
                return element ? element.value : defaultValue;
            }

            // æ”¶é›†æ¨™é¡Œè³‡è¨Š
            const headerInputs = document.querySelectorAll('.header input');
            const projectName = headerInputs[0] ? headerInputs[0].value : 'AMRå°ˆæ¡ˆé€²åº¦èˆ‡è³‡æºç®¡ç†æ©Ÿåˆ¶å»ºç½®';
            const projectManager = headerInputs[1] ? headerInputs[1].value : 'å°ˆæ¡ˆç®¡ç†éƒ¨';
            const period = headerInputs[2] ? headerInputs[2].value : 'w31 2025.07.28-2025.08.01';

            // æ”¶é›†å°ˆæ¡ˆæ¦‚æ³
            const overviewTable = document.querySelector('.section table');
            const overviewInputs = overviewTable ? overviewTable.querySelectorAll('input, textarea') : [];
            const projectDescription = document.querySelector('textarea') ? document.querySelector('textarea').value : '';
            const status = overviewInputs[2] ? overviewInputs[2].value : 'é€²è¡Œä¸­ (Plan)';
            const relatedDocs = overviewInputs[overviewInputs.length - 1] ? overviewInputs[overviewInputs.length - 1].value : '';

            return {
                projectName: projectName,
                projectManager: projectManager,
                period: period,
                projectDescription: projectDescription,
                status: status,
                relatedDocs: relatedDocs,
                
                // é¢¨éšªç®¡ç†
                risks: Array.from(document.querySelectorAll('#riskTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        item: cells[0] ? cells[0].value : '',
                        solution: cells[1] ? cells[1].value : '',
                        owner: cells[2] ? cells[2].value : '',
                        deadline: cells[3] ? cells[3].value : ''
                    };
                }).filter(risk => risk.item), // éæ¿¾ç©ºçš„é¢¨éšªé …ç›®
                
                // å®Œæˆäº‹é …
                completedItems: Array.from(document.querySelectorAll('.checkmark + input')).map(input => input.value).filter(item => item),
                
                // å¾…è¾¦äº‹é …
                todoItems: Array.from(document.querySelectorAll('.cross + input')).map(input => input.value).filter(item => item),
                
                // NPI éšæ®µ
                npiStages: Array.from(document.querySelectorAll('#npiTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        stage: cells[0] ? cells[0].value : '',
                        milestone: cells[1] ? cells[1].value : '',
                        owner: cells[2] ? cells[2].value : '',
                        spi: cells[3] ? cells[3].value : ''
                    };
                }).filter(stage => stage.stage), // éæ¿¾ç©ºçš„éšæ®µ
                
                // é–‹ç™¼éšæ®µ
                devPhases: Array.from(document.querySelectorAll('.phase')).map(phase => {
                    const inputs = phase.querySelectorAll('input');
                    return {
                        code: inputs[0] ? inputs[0].value : '',
                        name: inputs[1] ? inputs[1].value : '',
                        date: inputs[2] ? inputs[2].value : '',
                        description: inputs[3] ? inputs[3].value : ''
                    };
                }).filter(phase => phase.code), // éæ¿¾ç©ºçš„éšæ®µ
                
                // æ±ºç­–éœ€æ±‚
                decisions: Array.from(document.querySelectorAll('#decisionTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        item: cells[0] ? cells[0].value : '',
                        urgency: cells[1] ? cells[1].value : '',
                        deadline: cells[2] ? cells[2].value : '',
                        impact: cells[3] ? cells[3].value : ''
                    };
                }).filter(decision => decision.item) // éæ¿¾ç©ºçš„æ±ºç­–é …ç›®
            };
        }

        // ç”Ÿæˆ Markdown å…§å®¹
        function generateMarkdown(data) {
            return `# å°ˆæ¡ˆé€±å ±ï¼š${data.projectName}

**è² è²¬PMï¼š** ${data.projectManager}  
**é€±æœŸï¼š** ${data.period}  
**å°ˆæ¡ˆç‹€æ…‹ï¼š** ${data.status}

## å°ˆæ¡ˆæ¦‚æ³

### éœ€æ±‚æè¿°
${data.projectDescription}

### ç›¸é—œè³‡æ–™
${data.relatedDocs}

## é‡è¦é€²åº¦ / é€²åº¦æ›´æ–°

### âœ… æœ¬é€±å®Œæˆäº‹é …
${data.completedItems.map(item => `- ${item}`).join('\n')}

### ğŸ“‹ ä¸‹é€±é‡é»äº‹é …
${data.todoItems.map(item => `- ${item}`).join('\n')}

## é¢¨éšªç®¡ç†

| é¢¨éšªè­˜é¡Œ | æè§£æªæ–½ | è² è²¬äºº | ç›®æ¨™å®Œæˆæ™‚é–“ |
|---------|---------|--------|-------------|
${data.risks.map(risk => `| ${risk.item} | ${risk.solution} | ${risk.owner} | ${risk.deadline} |`).join('\n')}

## é—œéµ NPI

| NPIéšæ®µ | Milestone | Owner | SPI |
|---------|-----------|-------|-----|
${data.npiStages.map(stage => `| ${stage.stage} | ${stage.milestone} | ${stage.owner} | ${stage.spi} |`).join('\n')}

## é–‹ç™¼éšæ®µç‹€æ…‹

${data.devPhases.map(phase => `### ${phase.code} - ${phase.name}
**æ—¥æœŸï¼š** ${phase.date}  
**æè¿°ï¼š** ${phase.description}`).join('\n\n')}

## ç®¡ç†å±¤æ±ºç­–éœ€æ±‚

| æ±ºç­–é …ç›® | ç·Šæ€¥ç¨‹åº¦ | é æœŸæ±ºç­–æ™‚é–“ | ç›¸é—œå½±éŸ¿ |
|---------|---------|-------------|----------|
${data.decisions.map(decision => `| ${decision.item} | ${decision.urgency} | ${decision.deadline} | ${decision.impact} |`).join('\n')}

---
*åŒ¯å‡ºæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}*
`;
        }

        // ä¸‹è¼‰ Markdown æª”æ¡ˆ
        function downloadMarkdown(content, filename) {
            const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // å¾ Markdown åŒ¯å…¥
        function importFromMarkdown(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const markdown = e.target.result;
                    const data = parseMarkdown(markdown);
                    populateForm(data);
                    updateStatus('âœ… Markdown æª”æ¡ˆå·²åŒ¯å…¥');
                } catch (error) {
                    updateStatus('âŒ åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼ä¸æ­£ç¢º');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // è§£æ Markdown å…§å®¹
        function parseMarkdown(markdown) {
            const data = {};
            
            // è§£ææ¨™é¡Œ
            const titleMatch = markdown.match(/# å°ˆæ¡ˆé€±å ±ï¼š(.+)/);
            if (titleMatch) data.projectName = titleMatch[1];
            
            // è§£æåŸºæœ¬è³‡è¨Š
            const pmMatch = markdown.match(/\*\*è² è²¬PMï¼š\*\* (.+)/);
            if (pmMatch) data.projectManager = pmMatch[1];
            
            const periodMatch = markdown.match(/\*\*é€±æœŸï¼š\*\* (.+)/);
            if (periodMatch) data.period = periodMatch[1];
            
            const statusMatch = markdown.match(/\*\*å°ˆæ¡ˆç‹€æ…‹ï¼š\*\* (.+)/);
            if (statusMatch) data.status = statusMatch[1];
            
            // è§£æéœ€æ±‚æè¿°
            const descMatch = markdown.match(/### éœ€æ±‚æè¿°\n([\s\S]*?)\n### ç›¸é—œè³‡æ–™/);
            if (descMatch) data.projectDescription = descMatch[1].trim();
            
            // è§£æç›¸é—œè³‡æ–™
            const docsMatch = markdown.match(/### ç›¸é—œè³‡æ–™\n(.+)/);
            if (docsMatch) data.relatedDocs = docsMatch[1];
            
            // è§£æå®Œæˆäº‹é …
            const completedMatch = markdown.match(/### âœ… æœ¬é€±å®Œæˆäº‹é …\n([\s\S]*?)\n### ğŸ“‹/);
            if (completedMatch) {
                data.completedItems = completedMatch[1].split('\n')
                    .filter(line => line.startsWith('- '))
                    .map(line => line.substring(2));
            }
            
            // è§£æå¾…è¾¦äº‹é …
            const todoMatch = markdown.match(/### ğŸ“‹ ä¸‹é€±é‡é»äº‹é …\n([\s\S]*?)\n## é¢¨éšªç®¡ç†/);
            if (todoMatch) {
                data.todoItems = todoMatch[1].split('\n')
                    .filter(line => line.startsWith('- '))
                    .map(line => line.substring(2));
            }
            
            return data;
        }

        // å¡«å…¥è¡¨å–®è³‡æ–™
        function populateForm(data) {
            // å®‰å…¨è¨­ç½®å…ƒç´ å€¼çš„è¼”åŠ©å‡½æ•¸
            function safeSetValue(selector, value) {
                const element = document.querySelector(selector);
                if (element && value) {
                    element.value = value;
                }
            }

            // å¡«å…¥æ¨™é¡Œè³‡è¨Š
            const headerInputs = document.querySelectorAll('.header input');
            if (headerInputs[0] && data.projectName) headerInputs[0].value = data.projectName;
            if (headerInputs[1] && data.projectManager) headerInputs[1].value = data.projectManager;
            if (headerInputs[2] && data.period) headerInputs[2].value = data.period;

            // å¡«å…¥å°ˆæ¡ˆæè¿°
            const textarea = document.querySelector('textarea');
            if (textarea && data.projectDescription) {
                textarea.value = data.projectDescription;
            }

            // å¡«å…¥å°ˆæ¡ˆç‹€æ…‹å’Œç›¸é—œè³‡æ–™
            const overviewTable = document.querySelector('.section table');
            if (overviewTable) {
                const overviewInputs = overviewTable.querySelectorAll('input');
                if (overviewInputs[2] && data.status) overviewInputs[2].value = data.status;
                if (overviewInputs[overviewInputs.length - 1] && data.relatedDocs) {
                    overviewInputs[overviewInputs.length - 1].value = data.relatedDocs;
                }
            }
            
            // å¡«å…¥å®Œæˆäº‹é …
            if (data.completedItems && data.completedItems.length > 0) {
                const completedInputs = document.querySelectorAll('.checkmark + input');
                data.completedItems.forEach((item, index) => {
                    if (completedInputs[index] && item) {
                        completedInputs[index].value = item;
                    }
                });
            }
            
            // å¡«å…¥å¾…è¾¦äº‹é …
            if (data.todoItems && data.todoItems.length > 0) {
                const todoInputs = document.querySelectorAll('.cross + input');
                data.todoItems.forEach((item, index) => {
                    if (todoInputs[index] && item) {
                        todoInputs[index].value = item;
                    }
                });
            }

            // å¡«å…¥é¢¨éšªç®¡ç†è³‡æ–™
            if (data.risks && data.risks.length > 0) {
                const riskRows = document.querySelectorAll('#riskTable tr');
                data.risks.forEach((risk, index) => {
                    const rowIndex = index + 1; // è·³éæ¨™é¡Œè¡Œ
                    if (riskRows[rowIndex]) {
                        const inputs = riskRows[rowIndex].querySelectorAll('input');
                        if (inputs[0] && risk.item) inputs[0].value = risk.item;
                        if (inputs[1] && risk.solution) inputs[1].value = risk.solution;
                        if (inputs[2] && risk.owner) inputs[2].value = risk.owner;
                        if (inputs[3] && risk.deadline) inputs[3].value = risk.deadline;
                    }
                });
            }
        }

        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        function updateStatus(message) {
            const status = document.getElementById('backupStatus');
            status.textContent = message;
            setTimeout(() => {
                status.textContent = 'æº–å‚™å°±ç·’';
            }, 3000);
        }
    </script>
</body>
</html>