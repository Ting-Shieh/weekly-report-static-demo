<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電動腳踏車通路商合作專案週報</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #4472C4;
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .editable {
            background-color: transparent;
            border: none;
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            width: 100%;
            padding: 2px;
            outline: none;
        }
        .editable:focus {
            background-color: rgba(255, 255, 255, 0.3);
            border: 1px solid #fff;
        }
        td .editable {
            background-color: transparent;
            color: inherit;
        }
        td .editable:focus {
            background-color: rgba(68, 114, 196, 0.1);
            border: 1px solid #4472C4;
        }
        textarea.editable {
            font-family: inherit;
            font-size: inherit;
            line-height: 1.4;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .section {
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .section-title {
            background-color: #E7F3FF;
            color: #4472C4;
            font-weight: bold;
            padding: 8px;
            margin: -15px -15px 15px -15px;
            border-radius: 5px 5px 0 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .status-green {
            background-color: #92D050;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .status-yellow {
            background-color: #FFC000;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .status-red {
            background-color: #FF0000;
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .checkmark {
            color: green;
            font-weight: bold;
        }
        .cross {
            color: red;
            font-weight: bold;
        }
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        .phase {
            text-align: center;
            flex: 1;
        }
        .phase-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .phase-active {
            background-color: #4472C4;
        }
        .phase-completed {
            background-color: #92D050;
        }
        .phase-pending {
            background-color: #B0B0B0;
        }
        .footer {
            background: linear-gradient(90deg, #00CCCC, #0099CC);
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            font-style: italic;
            margin-top: 20px;
        }
        .full-width {
            grid-column: 1 / -1;
        }

        /* PDF 列印樣式 */
        @media print {
            body {
                background-color: white !important;
                margin: 0;
                padding: 10px;
                font-size: 12px;
            }
            
            .backup-controls {
                display: none !important;
            }
            
            .header {
                background-color: #4472C4 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .section {
                background-color: white !important;
                border: 1px solid #333 !important;
                page-break-inside: avoid;
                margin-bottom: 15px;
            }
            
            .section-title {
                background-color: #E7F3FF !important;
                color: #4472C4 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .container {
                display: block !important;
            }
            
            .container .section {
                width: 48% !important;
                display: inline-block !important;
                vertical-align: top !important;
                margin-right: 2% !important;
            }
            
            .full-width {
                width: 100% !important;
                display: block !important;
            }
            
            table {
                border-collapse: collapse !important;
                width: 100% !important;
            }
            
            th, td {
                border: 1px solid #333 !important;
                padding: 6px !important;
                font-size: 11px !important;
            }
            
            th {
                background-color: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .status-green, .status-yellow, .status-red {
                border: 1px solid #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .timeline {
                display: flex !important;
                justify-content: space-between !important;
                page-break-inside: avoid;
            }
            
            .phase {
                flex: 1 !important;
                text-align: center !important;
            }
            
            .phase-circle {
                border: 1px solid #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .footer {
                background: linear-gradient(90deg, #00CCCC, #0099CC) !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            input, textarea {
                border: none !important;
                background: transparent !important;
                outline: none !important;
                color: inherit !important;
            }
            
            /* 確保分頁合理 */
            .section {
                page-break-inside: avoid;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        【專案週報】<input type="text" class="editable" value="AMR專案進度與資源管理機制建置" style="color: white;"> - <input type="text" class="editable" value="專案管理部" style="color: white; width: 100px;"> (<input type="text" class="editable" value="w31 2025.07.28-2025.08.01" style="color: white; width: 200px;">)
    </div>

    <div class="backup-controls">
        <button onclick="exportToMarkdown()">📁 匯出 Markdown</button>
        <button onclick="exportToPDF()">📄 匯出 PDF</button>
        <label for="importFile">📂 匯入 Markdown</label>
        <input type="file" id="importFile" accept=".md,.txt" onchange="importFromMarkdown(event)">
        <span class="backup-status" id="backupStatus">準備就緒</span>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-title">0.專案概況</div>
            <table>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">專案名稱</td>
                    <td><input type="text" class="editable" value="AMR專案進度與資源管理機制建置"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">負責PM</td>
                    <td><input type="text" class="editable" value="專案管理部"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">專案狀態</td>
                    <td><span class="status-yellow"></span> <input type="text" class="editable" value="進行中 (Plan)"></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">需求描述</td>
                    <td><textarea class="editable" style="min-height: 80px; resize: vertical;" placeholder="請描述專案需求、目標與預期產出，以利團隊對齊執行方向">建立一個機制來管理AMR所有的專案項目之進度與資源，確保專案可以如期如值完成。透過系統化的專案盤點，追蹤每個專案的執行狀態、資源需求及產生效益。建立標準化的專案管理流程，提升整體專案成功率與資源使用效率，並建立可視化的專案儀表板供管理層決策參考。</textarea></td>
                </tr>
                <tr>
                    <td style="background-color: #f0f0f0; font-weight: bold;">相關資料</td>
                    <td><input type="text" class="editable" value="專案管理標準作業程序、資源分配矩陣、效益評估表"></td>
                </tr>
            </table>
        </div>

        <div class="section">
            <div class="section-title">3.風險管理</div>
            <table id="riskTable">
                <tr>
                    <th>風險識題</th>
                    <th>影響程度</th>
                    <th>提解措施</th>
                    <th>負責人</th>
                    <th>目標完成時間</th>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="各部門配合度不足"></td>
                    <td><span class="status-red"></span></td>
                    <td><input type="text" class="editable" value="建立高層支持與激勵機制"></td>
                    <td><input type="text" class="editable" value="專案管理部"></td>
                    <td><input type="text" class="editable" value="8月中旬完成"></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="系統整合複雜度高"></td>
                    <td><span class="status-yellow"></span></td>
                    <td><input type="text" class="editable" value="分階段導入與測試驗證"></td>
                    <td><input type="text" class="editable" value="IT部門"></td>
                    <td><input type="text" class="editable" value="9月底前驗證"></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="資料品質與一致性"></td>
                    <td><span class="status-yellow"></span></td>
                    <td><input type="text" class="editable" value="建立資料標準化流程"></td>
                    <td><input type="text" class="editable" value="各專案負責人"></td>
                    <td><input type="text" class="editable" value="持續進行"></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <div class="section-title">1.重要進度 / 進度更新</div>
            <div style="margin-top: 15px;">
                <div><span class="checkmark">✓</span> 本週完成事項</div>
                <div style="margin-left: 20px; margin-top: 5px;">
                    <span class="checkmark">✓</span> <input type="text" class="editable" value="完成現有專案清單盤點"><br>
                    <span class="checkmark">✓</span> <input type="text" class="editable" value="建立專案分類與優先級定義"><br>
                    <span class="checkmark">✓</span> <input type="text" class="editable" value="制定專案管理標準作業程序初稿">
                </div>
                
                <div style="margin-top: 15px;"><span class="cross">✗</span> 下週重點事項</div>
                <div style="margin-left: 20px; margin-top: 5px;">
                    <span class="cross">✗</span> <input type="text" class="editable" value="設計專案管理儀表板架構"><br>
                    <span class="cross">✗</span> <input type="text" class="editable" value="建立資源需求評估模型"><br>
                    <span class="cross">✗</span> <input type="text" class="editable" value="規劃效益衡量指標與KPI"><br>
                    <span class="cross">✗</span> <input type="text" class="editable" value="啟動跨部門協作機制建立">
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">2.關鍵 NPI</div>
            <table id="npiTable">
                <tr>
                    <th>NPI階段</th>
                    <th>Milestone</th>
                    <th>Owner</th>
                    <th>SPI</th>
                    <th>狀態</th>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C0"></td>
                    <td><input type="text" class="editable" value="專案盤點與需求確認"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0.9"></td>
                    <td><span class="status-green"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C1"></td>
                    <td><input type="text" class="editable" value="管理機制設計與驗證"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0.3"></td>
                    <td><span class="status-yellow"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C2"></td>
                    <td><input type="text" class="editable" value="系統平台建置與測試"></td>
                    <td><input type="text" class="editable" value="IT部門"></td>
                    <td><input type="text" class="editable" value="0.1"></td>
                    <td><span class="status-red"></span></td>
                </tr>
                <tr>
                    <td><input type="text" class="editable" value="C3"></td>
                    <td><input type="text" class="editable" value="試營運與成效驗證"></td>
                    <td><input type="text" class="editable" value="PM"></td>
                    <td><input type="text" class="editable" value="0"></td>
                    <td><span class="status-red"></span></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="section full-width">
        <div class="section-title">4.開發階段狀態</div>
        <div class="timeline">
            <div class="phase">
                <div class="phase-circle phase-completed"><input type="text" class="editable" value="C0" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="Idea" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="8/5" style="font-size:12px;"><br><input type="text" class="editable" value="專案盤點完成" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-active"><input type="text" class="editable" value="C1" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="Plan" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="8/20" style="font-size:12px;"><br><input type="text" class="editable" value="管理機制設計" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C2" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="EVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="9/15" style="font-size:12px;"><br><input type="text" class="editable" value="系統平台建置" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C3" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="DVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="10/1" style="font-size:12px;"><br><input type="text" class="editable" value="試營運驗證" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C4" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="PVT" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="10/15" style="font-size:12px;"><br><input type="text" class="editable" value="效果評估優化" style="font-size:12px;"></div>
            </div>
            <div class="phase">
                <div class="phase-circle phase-pending"><input type="text" class="editable" value="C5" style="background:transparent; color:white; border:none; text-align:center; width:20px;"></div>
                <div><strong><input type="text" class="editable" value="MP" style="font-weight:bold;"></strong></div>
                <div style="font-size: 12px;"><input type="text" class="editable" value="11/1" style="font-size:12px;"><br><input type="text" class="editable" value="正式上線推廣" style="font-size:12px;"></div>
            </div>
        </div>
    </div>

    <div class="section full-width">
        <div class="section-title">5.管理層決策需求</div>
        <table id="decisionTable">
            <tr>
                <th style="width: 30%;">決策項目</th>
                <th style="width: 15%;">緊急程度</th>
                <th style="width: 20%;">預期決策時間</th>
                <th style="width: 35%;">相關影響</th>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="專案管理系統平台選型"></td>
                <td><span class="status-red"></span> <input type="text" class="editable" value="緊急"></td>
                <td><input type="text" class="editable" value="8月15日前"></td>
                <td><input type="text" class="editable" value="影響後續系統建置時程與預算"></td>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="跨部門協作獎勵機制"></td>
                <td><span class="status-yellow"></span> <input type="text" class="editable" value="重要"></td>
                <td><input type="text" class="editable" value="9月1日前"></td>
                <td><input type="text" class="editable" value="決定各部門參與積極度與配合度"></td>
            </tr>
            <tr>
                <td><input type="text" class="editable" value="專案分級與資源配置標準"></td>
                <td><span class="status-green"></span> <input type="text" class="editable" value="一般"></td>
                <td><input type="text" class="editable" value="9月20日前"></td>
                <td><input type="text" class="editable" value="影響資源分配效率與專案優先級"></td>
            </tr>
        </table>
    </div>

    <div class="footer">
        Innovate Today, Embrace Tomorrow
    </div>

    <script>
        // 匯出為 PDF 格式
        function exportToPDF() {
            updateStatus('📄 準備生成 PDF...');
            
            // 等待一小段時間讓狀態更新顯示
            setTimeout(() => {
                // 觸發瀏覽器的列印對話框
                window.print();
                updateStatus('✅ PDF 列印對話框已開啟');
            }, 200);
        }

        // 匯出為 Markdown 格式
        function exportToMarkdown() {
            const data = collectFormData();
            const markdown = generateMarkdown(data);
            downloadMarkdown(markdown, `專案週報_${data.projectName}_${new Date().toISOString().slice(0, 10)}.md`);
            updateStatus('✅ Markdown 檔案已匯出');
        }

        // 收集表單資料
        function collectFormData() {
            // 安全取得元素值的輔助函數
            function safeGetValue(selector, defaultValue = '') {
                const element = document.querySelector(selector);
                return element ? element.value : defaultValue;
            }

            // 收集標題資訊
            const headerInputs = document.querySelectorAll('.header input');
            const projectName = headerInputs[0] ? headerInputs[0].value : 'AMR專案進度與資源管理機制建置';
            const projectManager = headerInputs[1] ? headerInputs[1].value : '專案管理部';
            const period = headerInputs[2] ? headerInputs[2].value : 'w31 2025.07.28-2025.08.01';

            // 收集專案概況
            const overviewTable = document.querySelector('.section table');
            const overviewInputs = overviewTable ? overviewTable.querySelectorAll('input, textarea') : [];
            const projectDescription = document.querySelector('textarea') ? document.querySelector('textarea').value : '';
            const status = overviewInputs[2] ? overviewInputs[2].value : '進行中 (Plan)';
            const relatedDocs = overviewInputs[overviewInputs.length - 1] ? overviewInputs[overviewInputs.length - 1].value : '';

            return {
                projectName: projectName,
                projectManager: projectManager,
                period: period,
                projectDescription: projectDescription,
                status: status,
                relatedDocs: relatedDocs,
                
                // 風險管理
                risks: Array.from(document.querySelectorAll('#riskTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        item: cells[0] ? cells[0].value : '',
                        solution: cells[1] ? cells[1].value : '',
                        owner: cells[2] ? cells[2].value : '',
                        deadline: cells[3] ? cells[3].value : ''
                    };
                }).filter(risk => risk.item), // 過濾空的風險項目
                
                // 完成事項
                completedItems: Array.from(document.querySelectorAll('.checkmark + input')).map(input => input.value).filter(item => item),
                
                // 待辦事項
                todoItems: Array.from(document.querySelectorAll('.cross + input')).map(input => input.value).filter(item => item),
                
                // NPI 階段
                npiStages: Array.from(document.querySelectorAll('#npiTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        stage: cells[0] ? cells[0].value : '',
                        milestone: cells[1] ? cells[1].value : '',
                        owner: cells[2] ? cells[2].value : '',
                        spi: cells[3] ? cells[3].value : ''
                    };
                }).filter(stage => stage.stage), // 過濾空的階段
                
                // 開發階段
                devPhases: Array.from(document.querySelectorAll('.phase')).map(phase => {
                    const inputs = phase.querySelectorAll('input');
                    return {
                        code: inputs[0] ? inputs[0].value : '',
                        name: inputs[1] ? inputs[1].value : '',
                        date: inputs[2] ? inputs[2].value : '',
                        description: inputs[3] ? inputs[3].value : ''
                    };
                }).filter(phase => phase.code), // 過濾空的階段
                
                // 決策需求
                decisions: Array.from(document.querySelectorAll('#decisionTable tr')).slice(1).map(row => {
                    const cells = row.querySelectorAll('input');
                    return {
                        item: cells[0] ? cells[0].value : '',
                        urgency: cells[1] ? cells[1].value : '',
                        deadline: cells[2] ? cells[2].value : '',
                        impact: cells[3] ? cells[3].value : ''
                    };
                }).filter(decision => decision.item) // 過濾空的決策項目
            };
        }

        // 生成 Markdown 內容
        function generateMarkdown(data) {
            return `# 專案週報：${data.projectName}

**負責PM：** ${data.projectManager}  
**週期：** ${data.period}  
**專案狀態：** ${data.status}

## 專案概況

### 需求描述
${data.projectDescription}

### 相關資料
${data.relatedDocs}

## 重要進度 / 進度更新

### ✅ 本週完成事項
${data.completedItems.map(item => `- ${item}`).join('\n')}

### 📋 下週重點事項
${data.todoItems.map(item => `- ${item}`).join('\n')}

## 風險管理

| 風險識題 | 提解措施 | 負責人 | 目標完成時間 |
|---------|---------|--------|-------------|
${data.risks.map(risk => `| ${risk.item} | ${risk.solution} | ${risk.owner} | ${risk.deadline} |`).join('\n')}

## 關鍵 NPI

| NPI階段 | Milestone | Owner | SPI |
|---------|-----------|-------|-----|
${data.npiStages.map(stage => `| ${stage.stage} | ${stage.milestone} | ${stage.owner} | ${stage.spi} |`).join('\n')}

## 開發階段狀態

${data.devPhases.map(phase => `### ${phase.code} - ${phase.name}
**日期：** ${phase.date}  
**描述：** ${phase.description}`).join('\n\n')}

## 管理層決策需求

| 決策項目 | 緊急程度 | 預期決策時間 | 相關影響 |
|---------|---------|-------------|----------|
${data.decisions.map(decision => `| ${decision.item} | ${decision.urgency} | ${decision.deadline} | ${decision.impact} |`).join('\n')}

---
*匯出時間：${new Date().toLocaleString('zh-TW')}*
`;
        }

        // 下載 Markdown 檔案
        function downloadMarkdown(content, filename) {
            const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 從 Markdown 匯入
        function importFromMarkdown(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const markdown = e.target.result;
                    const data = parseMarkdown(markdown);
                    populateForm(data);
                    updateStatus('✅ Markdown 檔案已匯入');
                } catch (error) {
                    updateStatus('❌ 匯入失敗：檔案格式不正確');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // 解析 Markdown 內容
        function parseMarkdown(markdown) {
            const data = {};
            
            // 解析標題
            const titleMatch = markdown.match(/# 專案週報：(.+)/);
            if (titleMatch) data.projectName = titleMatch[1];
            
            // 解析基本資訊
            const pmMatch = markdown.match(/\*\*負責PM：\*\* (.+)/);
            if (pmMatch) data.projectManager = pmMatch[1];
            
            const periodMatch = markdown.match(/\*\*週期：\*\* (.+)/);
            if (periodMatch) data.period = periodMatch[1];
            
            const statusMatch = markdown.match(/\*\*專案狀態：\*\* (.+)/);
            if (statusMatch) data.status = statusMatch[1];
            
            // 解析需求描述
            const descMatch = markdown.match(/### 需求描述\n([\s\S]*?)\n### 相關資料/);
            if (descMatch) data.projectDescription = descMatch[1].trim();
            
            // 解析相關資料
            const docsMatch = markdown.match(/### 相關資料\n(.+)/);
            if (docsMatch) data.relatedDocs = docsMatch[1];
            
            // 解析完成事項
            const completedMatch = markdown.match(/### ✅ 本週完成事項\n([\s\S]*?)\n### 📋/);
            if (completedMatch) {
                data.completedItems = completedMatch[1].split('\n')
                    .filter(line => line.startsWith('- '))
                    .map(line => line.substring(2));
            }
            
            // 解析待辦事項
            const todoMatch = markdown.match(/### 📋 下週重點事項\n([\s\S]*?)\n## 風險管理/);
            if (todoMatch) {
                data.todoItems = todoMatch[1].split('\n')
                    .filter(line => line.startsWith('- '))
                    .map(line => line.substring(2));
            }
            
            return data;
        }

        // 填入表單資料
        function populateForm(data) {
            // 安全設置元素值的輔助函數
            function safeSetValue(selector, value) {
                const element = document.querySelector(selector);
                if (element && value) {
                    element.value = value;
                }
            }

            // 填入標題資訊
            const headerInputs = document.querySelectorAll('.header input');
            if (headerInputs[0] && data.projectName) headerInputs[0].value = data.projectName;
            if (headerInputs[1] && data.projectManager) headerInputs[1].value = data.projectManager;
            if (headerInputs[2] && data.period) headerInputs[2].value = data.period;

            // 填入專案描述
            const textarea = document.querySelector('textarea');
            if (textarea && data.projectDescription) {
                textarea.value = data.projectDescription;
            }

            // 填入專案狀態和相關資料
            const overviewTable = document.querySelector('.section table');
            if (overviewTable) {
                const overviewInputs = overviewTable.querySelectorAll('input');
                if (overviewInputs[2] && data.status) overviewInputs[2].value = data.status;
                if (overviewInputs[overviewInputs.length - 1] && data.relatedDocs) {
                    overviewInputs[overviewInputs.length - 1].value = data.relatedDocs;
                }
            }
            
            // 填入完成事項
            if (data.completedItems && data.completedItems.length > 0) {
                const completedInputs = document.querySelectorAll('.checkmark + input');
                data.completedItems.forEach((item, index) => {
                    if (completedInputs[index] && item) {
                        completedInputs[index].value = item;
                    }
                });
            }
            
            // 填入待辦事項
            if (data.todoItems && data.todoItems.length > 0) {
                const todoInputs = document.querySelectorAll('.cross + input');
                data.todoItems.forEach((item, index) => {
                    if (todoInputs[index] && item) {
                        todoInputs[index].value = item;
                    }
                });
            }

            // 填入風險管理資料
            if (data.risks && data.risks.length > 0) {
                const riskRows = document.querySelectorAll('#riskTable tr');
                data.risks.forEach((risk, index) => {
                    const rowIndex = index + 1; // 跳過標題行
                    if (riskRows[rowIndex]) {
                        const inputs = riskRows[rowIndex].querySelectorAll('input');
                        if (inputs[0] && risk.item) inputs[0].value = risk.item;
                        if (inputs[1] && risk.solution) inputs[1].value = risk.solution;
                        if (inputs[2] && risk.owner) inputs[2].value = risk.owner;
                        if (inputs[3] && risk.deadline) inputs[3].value = risk.deadline;
                    }
                });
            }
        }

        // 更新狀態顯示
        function updateStatus(message) {
            const status = document.getElementById('backupStatus');
            status.textContent = message;
            setTimeout(() => {
                status.textContent = '準備就緒';
            }, 3000);
        }
    </script>
</body>
</html>